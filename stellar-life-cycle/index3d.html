<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XDCHJQ15WZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XDCHJQ15WZ');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Stellar Life Cycle Simulator</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            color: white;
            background-color: #000;
        }
        #canvas-container {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        #info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 300px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            z-index: 10;
        }
        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 10;
        }
        #timeline {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .stage-marker {
            width: 12px;
            height: 12px;
            background-color: white;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .stage-marker:hover {
            transform: scale(1.5);
        }
        .active-marker {
            background-color: #ffcc00;
        }
        button {
            background-color: #444;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #666;
        }
        .slider {
            width: 100%;
            margin: 10px 0;
        }
        h2, h3 {
            margin-top: 0;
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            text-align: center;
        }
        #cutaway-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
        }
        #star-class-selector {
            position: absolute;
            top: 70px;
            left: 20px;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 10px;
        }
        #parameters-panel {
            position: absolute;
            top: 150px;
            left: 20px;
            width: 250px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 10px;
            z-index: 10;
        }
        #legend {
            position: absolute;
            bottom: 80px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 10px;
            z-index: 10;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }
        /* Toggle switch styles */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider-switch {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #444;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider-switch:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider-switch {
            background-color: #666;
        }
        
        input:checked + .slider-switch:before {
            transform: translateX(26px);
        }
        
        .toggle-label {
            margin-right: 10px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div id="loading">Loading Stellar Simulator...</div>
    <div id="canvas-container"></div>
    
    <div id="cutaway-toggle">
        <span class="toggle-label">Cutaway View</span>
        <label class="switch">
            <input type="checkbox" id="toggle-cutaway" checked>
            <span class="slider-switch"></span>
        </label>
    </div>
    
    <div id="star-class-selector">
        <h3>Star Class</h3>
        <select id="star-size-class">
            <option value="brown-dwarf">Brown Dwarf</option>
            <option value="red-dwarf">Red Dwarf</option>
            <option value="sun-like" selected>Sun-like</option>
            <option value="giant">Giant</option>
            <option value="supergiant">Supergiant</option>
        </select>
    </div>
    
    <div id="parameters-panel">
        <h3>Star Parameters</h3>
        <div>
            <label for="size-multiplier">Size: <span id="size-value">1.0</span>x</label>
            <input type="range" id="size-multiplier" min="0.5" max="2" step="0.1" value="1.0" class="slider">
        </div>
        <div>
            <label for="rotation-speed">Rotation Speed: <span id="rotation-speed-value">0.1</span>x</label>
            <input type="range" id="rotation-speed" min="0" max="3" step="0.1" value="0.1" class="slider">
        </div>
    </div>
    
    <div id="info-panel">
        <h2 id="current-stage">Main Sequence Star</h2>
        <div id="stage-description">
            A main sequence star is in the stable part of its life, fusing hydrogen into helium in its core.
        </div>
        <h3>Current Fusion Process</h3>
        <div id="fusion-info">
            Hydrogen → Helium
        </div>
        <h3>Star Composition</h3>
        <div id="composition-info">
            Hydrogen: 70%, Helium: 28%, Other: 2%
        </div>
        <h3>Layers</h3>
        <div id="layers-info">
            <p><strong>Core:</strong> 15 million K, fusion reactions</p>
            <p><strong>Radiative Zone:</strong> Energy transport via radiation</p>
            <p><strong>Convective Zone:</strong> Energy transport via convection</p>
            <p><strong>Photosphere:</strong> Visible surface</p>
            <p><strong>Chromosphere:</strong> Lower atmosphere</p>
            <p><strong>Corona:</strong> Extended outer atmosphere</p>
        </div>
    </div>

    <div id="legend">
        <h3>Layer Color Legend</h3>
        <div id="legend-content"></div>
    </div>
    
    <div id="timeline">
        <div class="stage-marker active-marker" data-stage="protostar" title="Protostar"></div>
        <div class="stage-marker" data-stage="main-sequence" title="Main Sequence"></div>
        <div class="stage-marker" data-stage="red-giant" title="Red Giant"></div>
        <div class="stage-marker" data-stage="white-dwarf" title="White Dwarf/Supernova"></div>
        <div class="stage-marker" data-stage="remnant" title="Remnant (Neutron Star/Black Hole)"></div>
    </div>
    
    <div id="controls">
        <button id="reset-view">Reset View</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Main JavaScript code for the stellar simulator
        let scene, camera, renderer, star, starLayers, currentStarClass, currentStage;
        let isRotating = true;
        let cutawayMode = true;
        let sizeMultiplier = 1.0;
        let rotationSpeedMultiplier = 0.1;
        
        // Star properties for different classes and stages
        const starClasses = {
            'brown-dwarf': {
                radius: 0.5,
                color: 0x993300,
                lifespan: "More than Hubble time",
                temperature: "Less than 2,500 K",
                mass: "13-80 Jupiter masses",
                stages: {
                    'protostar': {
                        color: 0xcc3300,
                        layers: {
                            core: { radius: 0.3, color: 0xff6600 },
                            envelope: { radius: 0.5, color: 0x993300, opacity: 0.7 }
                        },
                        fusion: "No fusion or limited deuterium fusion",
                        composition: "Hydrogen: 75%, Helium: 25%, Other: <1%"
                    },
                    'main-sequence': {
                        color: 0x993300,
                        layers: {
                            core: { radius: 0.2, color: 0xff4400 },
                            radiative: { radius: 0.3, color: 0xcc3300, opacity: 0.8 },
                            convective: { radius: 0.45, color: 0x993300, opacity: 0.6 },
                            photosphere: { radius: 0.5, color: 0x882200, opacity: 0.4 }
                        },
                        fusion: "Limited or no hydrogen fusion",
                        composition: "Hydrogen: 73%, Helium: 26%, Other: 1%"
                    },
                    'red-giant': { // Brown dwarfs don't become red giants
                        color: 0x993300,
                        layers: {
                            core: { radius: 0.2, color: 0xff4400 },
                            convective: { radius: 0.45, color: 0x993300, opacity: 0.6 },
                            photosphere: { radius: 0.5, color: 0x882200, opacity: 0.4 }
                        },
                        fusion: "No fusion",
                        composition: "Hydrogen: 73%, Helium: 26%, Other: 1%"
                    },
                    'white-dwarf': { // Brown dwarfs don't become white dwarfs
                        color: 0x993300,
                        layers: {
                            core: { radius: 0.2, color: 0xff4400 },
                            convective: { radius: 0.45, color: 0x993300, opacity: 0.6 },
                            photosphere: { radius: 0.5, color: 0x882200, opacity: 0.4 }
                        },
                        fusion: "No fusion",
                        composition: "Hydrogen: 73%, Helium: 26%, Other: 1%"
                    },
                    'remnant': { // Brown dwarfs don't form remnants
                        color: 0x993300,
                        layers: {
                            core: { radius: 0.4, color: 0xff4400 },
                            surface: { radius: 0.5, color: 0x882200, opacity: 0.6 }
                        },
                        fusion: "No fusion",
                        composition: "Hydrogen: 73%, Helium: 26%, Other: 1%"
                    }
                }
            },
            'red-dwarf': {
                radius: 0.7,
                color: 0xff6644,
                lifespan: "Trillions of years",
                temperature: "2,500 - 4,000 K",
                mass: "0.08-0.5 solar masses",
                stages: {
                    'protostar': {
                        color: 0xff8866,
                        layers: {
                            core: { radius: 0.4, color: 0xff7744 },
                            envelope: { radius: 0.7, color: 0xff6644, opacity: 0.7 }
                        },
                        fusion: "Deuterium fusion beginning",
                        composition: "Hydrogen: 74%, Helium: 25%, Other: 1%"
                    },
                    'main-sequence': {
                        color: 0xff6644,
                        layers: {
                            core: { radius: 0.3, color: 0xff5533 },
                            convective: { radius: 0.65, color: 0xff6644, opacity: 0.7 },
                            photosphere: { radius: 0.7, color: 0xff7755, opacity: 0.5 }
                        },
                        fusion: "Hydrogen → Helium (fully convective)",
                        composition: "Hydrogen: 70%, Helium: 28%, Other: 2%"
                    },
                    'red-giant': { // Red dwarfs don't become red giants
                        color: 0xff6644,
                        layers: {
                            core: { radius: 0.3, color: 0xff5533 },
                            convective: { radius: 0.65, color: 0xff6644, opacity: 0.7 },
                            photosphere: { radius: 0.7, color: 0xff7755, opacity: 0.5 }
                        },
                        fusion: "Hydrogen → Helium (fully convective)",
                        composition: "Hydrogen: 70%, Helium: 28%, Other: 2%"
                    },
                    'white-dwarf': { // Red dwarfs don't become white dwarfs in the current universe's age
                        color: 0xff6644,
                        layers: {
                            core: { radius: 0.3, color: 0xff5533 },
                            convective: { radius: 0.65, color: 0xff6644, opacity: 0.7 },
                            photosphere: { radius: 0.7, color: 0xff7755, opacity: 0.5 }
                        },
                        fusion: "Hydrogen → Helium (fully convective)",
                        composition: "Hydrogen: 70%, Helium: 28%, Other: 2%"
                    },
                    'remnant': { // Theoretical only - blue/white dwarf
                        color: 0xaaccff,
                        layers: {
                            core: { radius: 0.2, color: 0xeeffff },
                            surface: { radius: 0.25, color: 0xccddff, opacity: 0.7 }
                        },
                        fusion: "No fusion (electron degeneracy pressure)",
                        composition: "Helium: 98%, Other: 2%"
                    }
                }
            },
            'sun-like': {
                radius: 1.0,
                color: 0xffdd00,
                lifespan: "10 billion years",
                temperature: "5,000 - 6,000 K",
                mass: "0.5-8 solar masses",
                stages: {
                    'protostar': {
                        color: 0xff9900,
                        layers: {
                            core: { radius: 0.5, color: 0xff8800 },
                            envelope: { radius: 1.0, color: 0xff9900, opacity: 0.7 }
                        },
                        fusion: "Deuterium fusion beginning",
                        composition: "Hydrogen: 73%, Helium: 25%, Other: 2%"
                    },
                    'main-sequence': {
                        color: 0xffdd00,
                        layers: {
                            core: { radius: 0.2, color: 0xffff99 },
                            radiative: { radius: 0.7, color: 0xffee55, opacity: 0.8 },
                            convective: { radius: 0.9, color: 0xffdd00, opacity: 0.6 },
                            photosphere: { radius: 1.0, color: 0xffcc00, opacity: 0.4 },
                            chromosphere: { radius: 1.05, color: 0xff5500, opacity: 0.2 },
                            corona: { radius: 1.3, color: 0xffffaa, opacity: 0.1 }
                        },
                        fusion: "Hydrogen → Helium (proton-proton chain)",
                        composition: "Hydrogen: 70%, Helium: 28%, Other: 2%"
                    },
                    'red-giant': {
                        color: 0xff5500,
                        layers: {
                            core: { radius: 0.05, color: 0xffffaa },
                            helium_shell: { radius: 0.1, color: 0xffdd55, opacity: 0.9 },
                            hydrogen_shell: { radius: 0.15, color: 0xffaa00, opacity: 0.8 },
                            envelope: { radius: 2.5, color: 0xff5500, opacity: 0.4 }
                        },
                        fusion: "Hydrogen shell burning, Helium core fusion (helium flash)",
                        composition: "Hydrogen: 65%, Helium: 30%, Carbon: 3%, Other: 2%"
                    },
                    'white-dwarf': {
                        color: 0xeeffff,
                        layers: {
                            core: { radius: 0.1, color: 0xffffff },
                            surface: { radius: 0.15, color: 0xddffff, opacity: 0.7 }
                        },
                        fusion: "No fusion (electron degeneracy pressure)",
                        composition: "Carbon: 50%, Oxygen: 45%, Other: 5%"
                    },
                    'remnant': { // For sun-like stars, this is just the white dwarf
                        color: 0xccddff,
                        layers: {
                            core: { radius: 0.1, color: 0xffffff },
                            surface: { radius: 0.15, color: 0xddffff, opacity: 0.7 }
                        },
                        fusion: "No fusion (electron degeneracy pressure)",
                        composition: "Carbon: 50%, Oxygen: 45%, Other: 5%"
                    }
                }
            },
            'giant': {
                radius: 1.5,
                color: 0xffaa00,
                lifespan: "100 million years",
                temperature: "10,000 - 30,000 K",
                mass: "8-20 solar masses",
                stages: {
                    'protostar': {
                        color: 0xff8800,
                        layers: {
                            core: { radius: 0.7, color: 0xff7700 },
                            envelope: { radius: 1.5, color: 0xff8800, opacity: 0.7 }
                        },
                        fusion: "Deuterium fusion beginning",
                        composition: "Hydrogen: 73%, Helium: 25%, Other: 2%"
                    },
                    'main-sequence': {
                        color: 0xffaa00,
                        layers: {
                            core: { radius: 0.4, color: 0xffffaa },
                            radiative: { radius: 1.0, color: 0xffcc00, opacity: 0.7 },
                            convective: { radius: 1.4, color: 0xffaa00, opacity: 0.5 },
                            photosphere: { radius: 1.5, color: 0xff9900, opacity: 0.3 }
                        },
                        fusion: "Hydrogen → Helium (CNO cycle)",
                        composition: "Hydrogen: 70%, Helium: 28%, Other: 2%"
                    },
                    'red-giant': {
                        color: 0xff4400,
                        layers: {
                            core: { radius: 0.1, color: 0xffffaa },
                            helium_shell: { radius: 0.2, color: 0xffdd55, opacity: 0.9 },
                            hydrogen_shell: { radius: 0.3, color: 0xffaa00, opacity: 0.8 },
                            envelope: { radius: 4.0, color: 0xff4400, opacity: 0.4 }
                        },
                        fusion: "Helium → Carbon, Hydrogen shell burning",
                        composition: "Hydrogen: 65%, Helium: 28%, Carbon: 5%, Other: 2%"
                    },
                    'white-dwarf': { // For giants, this is the supernova stage
                        color: 0xffff99,
                        layers: {
                            core: { radius: 0.3, color: 0xffffdd },
                            fusion_shells: { radius: 1.5, color: 0xffaa00, opacity: 0.7 },
                            exploding_envelope: { radius: 4.0, color: 0xff5500, opacity: 0.5 }
                        },
                        fusion: "Silicon → Iron (core collapse imminent)",
                        composition: "Complex mix of elements from fusion chain"
                    },
                    'remnant': { // Neutron star
                        color: 0x99ccff,
                        layers: {
                            core: { radius: 0.05, color: 0xddddff },
                            crust: { radius: 0.06, color: 0xaabbff, opacity: 0.9 }
                        },
                        fusion: "No fusion (neutron degeneracy pressure)",
                        composition: "Neutrons: 95%, Other: 5%"
                    }
                }
            },
            'supergiant': {
                radius: 2.0,
                color: 0x00aaff,
                lifespan: "10 million years",
                temperature: "20,000 - 50,000 K",
                mass: "20+ solar masses",
                stages: {
                    'protostar': {
                        color: 0x0088cc,
                        layers: {
                            core: { radius: 0.8, color: 0x0077bb },
                            envelope: { radius: 2.0, color: 0x0088cc, opacity: 0.7 }
                        },
                        fusion: "Deuterium fusion beginning",
                        composition: "Hydrogen: 73%, Helium: 25%, Other: 2%"
                    },
                    'main-sequence': {
                        color: 0x00aaff,
                        layers: {
                            core: { radius: 0.5, color: 0x99ddff },
                            radiative: { radius: 1.7, color: 0x00ccff, opacity: 0.7 },
                            convective: { radius: 1.9, color: 0x00aaff, opacity: 0.5 },
                            photosphere: { radius: 2.0, color: 0x0088dd, opacity: 0.3 }
                        },
                        fusion: "Hydrogen → Helium (CNO cycle dominant)",
                        composition: "Hydrogen: 70%, Helium: 28%, Other: 2%"
                    },
                    'red-giant': {
                        color: 0xff2200,
                        layers: {
                            core: { radius: 0.2, color: 0xeeffff },
                            helium_layer: { radius: 0.3, color: 0xffdd00, opacity: 0.9 },
                            carbon_layer: { radius: 0.4, color: 0xff9900, opacity: 0.8 },
                            neon_layer: { radius: 0.5, color: 0xff5500, opacity: 0.8 },
                            oxygen_layer: { radius: 0.6, color: 0xff0000, opacity: 0.7 },
                            silicon_layer: { radius: 0.7, color: 0xcc0000, opacity: 0.7 },
                            envelope: { radius: 5.0, color: 0xff2200, opacity: 0.4 }
                        },
                        fusion: "Multiple shell burning (He, C, Ne, O, Si)",
                        composition: "Layered - from iron core to hydrogen envelope"
                    },
                    'white-dwarf': { // For supergiants, this is the supernova stage
                        color: 0xffff66,
                        layers: {
                            iron_core: { radius: 0.2, color: 0xdddddd },
                            fusion_shells: { radius: 1.0, color: 0xffaa00, opacity: 0.7 },
                            exploding_envelope: { radius: 5.0, color: 0xff3300, opacity: 0.6 }
                        },
                        fusion: "Silicon → Iron core (supernova imminent)",
                        composition: "Complex onion-shell structure of elements"
                    },
                    'remnant': { // Black hole
                        color: 0x000000,
                        layers: {
                            event_horizon: { radius: 0.1, color: 0x000000 },
                            accretion_disk: { radius: 0.5, color: 0xff6600, opacity: 0.6 }
                        },
                        fusion: "No fusion (gravitational singularity)",
                        composition: "Compressed matter beyond atomic structure"
                    }
                }
            }
        };
        
        // Stage descriptions
        const stageDescriptions = {
            'protostar': "A protostar forms from a collapsing cloud of gas and dust, gradually heating up as it condenses due to gravity.",
            'main-sequence': "A main sequence star is in the stable part of its life, fusing hydrogen into helium in its core.",
            'red-giant': "As hydrogen in the core depletes, the star expands into a red giant, with shell hydrogen fusion and eventually helium fusion in the core.",
            'white-dwarf': "For sun-like stars, this is the final state after shedding outer layers. For massive stars, this stage represents the supernova phase.",
            'remnant': "The final state: white dwarf (sun-like stars), neutron star (giants), or black hole (supergiants)."
        };
        
        // Initialize the scene
        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000510);
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);
            
            // Add directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 3, 5);
            scene.add(directionalLight);
            
            // Add stars to background
            createStarfield();
            
            // Set initial star class and stage
            currentStarClass = 'sun-like';
            currentStage = 'main-sequence';
            
            // Create the star
            createStar();
            
            // Add event listeners
            addEventListeners();
            
            // Hide loading message
            document.getElementById('loading').style.display = 'none';
            
            // Start animation loop
            animate();
        }
        
        // Create starfield background
        function createStarfield() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.1,
                transparent: true
            });
            
            const starsVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }
            
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const starfield = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(starfield);
        }
        
        // Create the star with its layers
        function createStar() {
            // Remove existing star if present
            if (star) {
                scene.remove(star);
            }
            
            // Create a group to hold all star parts
            star = new THREE.Group();
            starLayers = {};
            
            const starData = starClasses[currentStarClass];
            const stageData = starData.stages[currentStage];
            
            // Create each layer of the star
            for (const [layerName, layerData] of Object.entries(stageData.layers)) {
                const geometry = new THREE.SphereGeometry(layerData.radius, 64, 64);
                
                // For cutaway view, we'll create a clipped sphere
                if (cutawayMode) {
                    // We need to modify the geometry for the cutaway
                    const positions = geometry.attributes.position;
                    
                    for (let i = 0; i < positions.count; i++) {
                        const x = positions.getX(i);
                        const y = positions.getY(i);
                        const z = positions.getZ(i);
                        
                        // If point is in the quarter to be cut away (positive x and z), move it
                        if (x > 0 && z > 0) {
                            positions.setX(i, -0.001); // Small offset to avoid z-fighting
                        }
                    }
                    
                    geometry.computeVertexNormals();
                }
                
                const material = new THREE.MeshPhongMaterial({
                    color: layerData.color,
                    transparent: true,
                    opacity: layerData.opacity || 1,
                    side: THREE.DoubleSide,
                    emissive: layerData.color,
                    emissiveIntensity: 0.2
                });
                
                const mesh = new THREE.Mesh(geometry, material);
                starLayers[layerName] = mesh;
                // Apply size multiplier to the whole star
                mesh.scale.set(sizeMultiplier, sizeMultiplier, sizeMultiplier);
                star.add(mesh);
            }
            
            scene.add(star);
            
            // Update information panel
            updateInfoPanel();
            
            // Update timeline markers
            updateTimelineMarkers();
            
            // Update the legend
            updateLegend();
        }
        
        // Update the information panel with current star and stage data
        function updateInfoPanel() {
            const starData = starClasses[currentStarClass];
            const stageData = starData.stages[currentStage];
            
            // Update stage title and description
            document.getElementById('current-stage').textContent = 
                capitalizeFirstLetter(currentStage.replace('-', ' ')) + 
                ' (' + capitalizeFirstLetter(currentStarClass.replace('-', ' ')) + ')';
            document.getElementById('stage-description').textContent = stageDescriptions[currentStage];
            
            // Update fusion information
            document.getElementById('fusion-info').textContent = stageData.fusion;
            
            // Update composition information
            document.getElementById('composition-info').textContent = stageData.composition;
            
            // Update layers information
            let layersHTML = '';
            for (const [layerName, layerObj] of Object.entries(stageData.layers)) {
                layersHTML += `<p><strong>${capitalizeFirstLetter(layerName.replace('_', ' '))}:</strong> ${getLayerDescription(layerName)}</p>`;
            }
            document.getElementById('layers-info').innerHTML = layersHTML;
        }
        
        // Update the color legend
        function updateLegend() {
            const starData = starClasses[currentStarClass];
            const stageData = starData.stages[currentStage];
            
            let legendHTML = '';
            for (const [layerName, layerData] of Object.entries(stageData.layers)) {
                const colorHex = '#' + layerData.color.toString(16).padStart(6, '0');
                legendHTML += `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${colorHex}"></div>
                    <div>${capitalizeFirstLetter(layerName.replace('_', ' '))}</div>
                </div>`;
            }
            document.getElementById('legend-content').innerHTML = legendHTML;
        }
        
        // Get descriptions for each layer type
        function getLayerDescription(layerName) {
            const descriptions = {
                'core': 'Nuclear fusion center, extremely high temperature and pressure',
                'radiative': 'Energy transport via radiation, particles absorb and re-emit photons',
                'convective': 'Energy transport via convection currents of plasma',
                'photosphere': 'Visible "surface" layer of the star',
                'chromosphere': 'Lower atmosphere above photosphere',
                'corona': 'Extended outer atmosphere, very hot but low density',
                'envelope': 'Outer gas layers of protostar or giant phase',
                'helium_shell': 'Shell where helium fusion occurs',
                'hydrogen_shell': 'Shell where hydrogen fusion occurs',
                'helium_layer': 'Layer composed primarily of helium',
                'carbon_layer': 'Layer composed primarily of carbon',
                'neon_layer': 'Layer composed primarily of neon',
                'oxygen_layer': 'Layer composed primarily of oxygen',
                'silicon_layer': 'Layer composed primarily of silicon',
                'iron_core': 'Core composed of iron, fusion endpoint',
                'event_horizon': 'Point of no return, where gravity prevents even light from escaping',
                'accretion_disk': 'Disk of matter spiraling into the black hole',
                'crust': 'Solid outer layer of a neutron star',
                'surface': 'Outer boundary of the stellar remnant',
                'fusion_shells': 'Multiple layers of different fusion processes',
                'exploding_envelope': 'Outer layers being expelled during stellar explosion'
            };
            
            return descriptions[layerName] || 'Star layer';
        }
        
        // Update timeline markers
        function updateTimelineMarkers() {
            const markers = document.querySelectorAll('.stage-marker');
            markers.forEach(marker => {
                marker.classList.remove('active-marker');
                if (marker.dataset.stage === currentStage) {
                    marker.classList.add('active-marker');
                }
            });
        }
        
        // Add event listeners for user interaction
        function addEventListeners() {
            // Mouse control variables
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            
            // Mouse controls for rotation and zoom
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = {
                    x: e.clientX,
                    y: e.clientY
                };
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const deltaMove = {
                    x: e.clientX - previousMousePosition.x,
                    y: e.clientY - previousMousePosition.y
                };
                
                // Rotate based on horizontal movement
                star.rotation.y += deltaMove.x * 0.01;
                
                // Optional: rotate on x-axis based on vertical movement
                star.rotation.x += deltaMove.y * 0.01;
                
                previousMousePosition = {
                    x: e.clientX,
                    y: e.clientY
                };
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            renderer.domElement.addEventListener('mouseleave', () => {
                isDragging = false;
            });
            
            // Mouse wheel for zoom
            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                
                // Zoom in/out based on wheel direction
                if (e.deltaY > 0) {
                    // Zoom out
                    camera.position.z += 0.5;
                } else {
                    // Zoom in
                    camera.position.z -= 0.5;
                    if (camera.position.z < 1) camera.position.z = 1;
                }
            }, { passive: false });
            
            document.getElementById('reset-view').addEventListener('click', () => {
                camera.position.z = 5;
                star.rotation.set(0, 0, 0);
            });
            
            document.getElementById('toggle-cutaway').addEventListener('change', () => {
                cutawayMode = document.getElementById('toggle-cutaway').checked;
                createStar(); // Recreate the star with new view mode
            });
            
            // Star class selector
            document.getElementById('star-size-class').addEventListener('change', (e) => {
                currentStarClass = e.target.value;
                createStar();
            });
            
            // Parameter sliders
            document.getElementById('size-multiplier').addEventListener('input', (e) => {
                sizeMultiplier = parseFloat(e.target.value);
                document.getElementById('size-value').textContent = sizeMultiplier.toFixed(1);
                
                // Update the scale of each layer
                for (const layerName in starLayers) {
                    starLayers[layerName].scale.set(sizeMultiplier, sizeMultiplier, sizeMultiplier);
                }
            });
            
            document.getElementById('rotation-speed').addEventListener('input', (e) => {
                rotationSpeedMultiplier = parseFloat(e.target.value);
                document.getElementById('rotation-speed-value').textContent = rotationSpeedMultiplier.toFixed(1);
            });
            
            // Timeline stage markers
            document.querySelectorAll('.stage-marker').forEach(marker => {
                marker.addEventListener('click', () => {
                    currentStage = marker.dataset.stage;
                    createStar();
                });
                
                // Add tooltip on hover
                marker.addEventListener('mouseover', (e) => {
                    const tooltip = document.createElement('div');
                    tooltip.textContent = e.target.title;
                    tooltip.style.position = 'absolute';
                    tooltip.style.top = (e.clientY - 30) + 'px';
                    tooltip.style.left = e.clientX + 'px';
                    tooltip.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
                    tooltip.style.padding = '5px';
                    tooltip.style.borderRadius = '3px';
                    tooltip.style.zIndex = '100';
                    tooltip.classList.add('tooltip');
                    document.body.appendChild(tooltip);
                });
                
                marker.addEventListener('mouseout', () => {
                    const tooltips = document.querySelectorAll('.tooltip');
                    tooltips.forEach(t => t.remove());
                });
            });
            
            // Window resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            // Add keyboard controls
            window.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'ArrowLeft':
                        star.rotation.y -= 0.1;
                        break;
                    case 'ArrowRight':
                        star.rotation.y += 0.1;
                        break;
                    case 'ArrowUp':
                        if (camera.position.z > 1) camera.position.z -= 0.5;
                        break;
                    case 'ArrowDown':
                        camera.position.z += 0.5;
                        break;
                    case 'c':
                        cutawayMode = !cutawayMode;
                        document.getElementById('toggle-cutaway').checked = cutawayMode;
                        createStar();
                        break;
                    case 'r':
                        isRotating = !isRotating;
                        break;
                    case '1':
                    case '2':
                    case '3':
                    case '4':
                    case '5':
                        const stages = ['protostar', 'main-sequence', 'red-giant', 'white-dwarf', 'remnant'];
                        currentStage = stages[parseInt(e.key) - 1];
                        createStar();
                        break;
                }
            });
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Rotate star continuously if auto-rotation is on
            if (isRotating) {
                star.rotation.y += 0.005 * rotationSpeedMultiplier;
            }
            
            renderer.render(scene, camera);
        }
        
        // Helper function to capitalize first letter
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        
        // Initialize when the page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>